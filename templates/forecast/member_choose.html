{% extends "base_with_tables.html" %}

{% block scripts %}
<script>
function showModal(member_name, member_id) {
  $("#modalHeader").html("Learning " + member_name + "'s secrets");
  $("#downloadLink")[0].setAttribute("href", "javascript:downloadArff(" + member_id + ")");
  $("#showLive")[0].setAttribute("href", "javascript:showLive(" + member_id + ")");
  $("#pageModal").modal();
}

function downloadArff(member_id) {
  $.get("/forecast/member/" + member_id + "/arff", function(data) {
    window.location = "/forecast/member/" + member_id + "/arff/download";
  });  
}

function showLive(member_id) {
  $.get("/forecast/member/" + member_id, function(data) {
    $("#modalBody").html(data);
    $("#pageModal").modal();
  });  
}
</script>
{% endblock %}

{% block content %}
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <div class="nav-collapse collapse" id="main-menu">
        <ul class="nav pull-left" id="main-menu-left">
          <li><a>Choose member to get predictor</a></li>
        </ul>
        <ul class="nav pull-right" id="main-menu-right">
          <li><a href="/">Home</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
<div class="container" style="color:#ffffff">
  place holder
</div>
<div class="container" style="color:#ffffff">
  place holder
</div>
<div class="container" style="color:#ffffff">
  place holder
</div>
{% if members_list %}
  <div class="container" dir="ltr">
    <table id="memberTable" class="tablesorter table table-bordered table-striped table-hover">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Party</th>
        <th>Is current?</th>
        <th>Position</th>
      </tr>
    </thead>
    <tbody>
    {% for member in members_list %}
      <tr>
        <th>{{ member.id }}</th>
        <th><a href="javascript:showModal('{{ member.name }}', {{ member.id }})">{{ member.name }}</a></th>
        <th>{{ member.party.name }}</th>
        <th>{% if member.is_current %}נוכחי{% else %}לשעבר{% endif %}</th>
        <th>{{ member.role }}</th>
      </tr>
    {% endfor %}
    </tbody>
    </table>
  </div>
  <script type="text/javascript">
    $(document).ready(function() {
      $("#memberTable").tablesorter();
    });
  </script>
  <div id="pageModal" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="modalHeader"></h3>
    </div>
    <div id="modalBody" class="modal-body">
    </div>
    <div class="modal-footer">
      <a id="downloadLink" class="btn" aria-hidden="true">Download arff</a>
      <a id="showLive" class="btn" aria-hidden="true">Show live</a>
      <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
  </div>
{% else %}
  <p>רשימת הח"כים ריקה.</p>
  <a href="/forecast/fetch/">ייבא רשימת ח"כים מחדש</a>
{% endif %}
{% endblock %}
